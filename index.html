<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>boo</title>
		<link rel="stylesheet" href="style.css">
	</head>

	<body>
		<div id="curtain"></div>
		<div id="chars" class="container">
			<h1>ghost club blues</h1>
			<div id="character_selection">
				<button onclick="selectKid('kitty')">kitty</button>
				<button onclick="selectKid('pup')"><p>pup<br />
					<i>coming soon!</i></p></button>
				<button onclick="selectKid('bird')"><p>bird<br />
					<i>coming soon!</i></p></button>
				<button id="play_button" class="button_secondary" onclick="play()">play as&nbsp;<span id="name"></span></button>
			</div>
			<div id="character_info"></div>
		</div>
		<div id="game" class="container">
			<div id="scene_name"></div>
			<div id="dialogue"></div>
			<div id="menu"></div><div id="menu_tooltip"></div>
		</div>
	</body>

	<script src="icons.js"></script>
	<script src="dialog.js"></script>
	<script src="objects.js"></script>
	<script src="scenes.js"></script>
	<script>
		var char_info = document.getElementById("character_info");
		var game = document.getElementById("game");
		var menu = document.getElementById("menu");
		var menu_tooltip = document.getElementById("menu_tooltip");
		var root = document.documentElement;

		window.oncontextmenu = function() {
			return false
		};

		function selectKid(name) {
			kids.current = name;
			char_info.style.display = "inline-block";
			char_info.className = "info_enter";
			char_info.innerHTML = kids[name].info;

			document.getElementById("play_button").style.display = "flex";
			document.getElementById("play_button").className = "button_secondary flicker-in";
			root.style.setProperty("--highlight", kids[name].bgcolor);

			cleart();

			document.getElementById("name").textContent = name;
		}

		function play() {
			transition(kids[kids.current].bgcolor, game);
			let menu = kids[kids.current].menu;
			for (let i=0; i<menu.length; i++) {
				printMenuIcon(kids[kids.current].menu[i])
			}
			setScene();
			document.querySelector("title").textContent = kids.current;
			animate();
		}

		var current_container = document.getElementById("chars");
		function transition(color, container) {
			let curtain = document.getElementById("curtain");
			curtain.style.background = color;
			curtain.className = "curtain_wipe";
			setTimeout(function() {
				current_container.style.display = "none";
				document.body.style.background = color;
				curtain.className = "";
				container.style.display = "block";
				current_container = container;
			}, 2000);
		}

		var dialogue = document.getElementById("dialogue");
		var scene_name = document.getElementById("scene_name");
		function setScene() {
			let scene = kids[kids.current].scene;
			scene_name.innerHTML = scene.sceneobject.name;

			let scenecontent = setObject(scene.sceneobject);
			for (let i=0; i<scene.objects.length; i++) {
				let line = setObject(scene.objects[i]);
				scenecontent += line + " ";
			}

			let sceneexits = "";
			for (let i=0; i<scene.exits.length; i++) {
				sceneexits += setObject(scene.exits[i]);
			}

			dialogue.innerHTML = scenecontent + "<br /><br />" + sceneexits;

			if (!scene.visited) { scene.visited = true }

			function setObject(obj) {
				return obj.line || obj.name
			}
		}

		function printMenuIcon(icon) {
			var button = document.createElement("button");
			button.textContent = icon.name;
			let tooltip = icon.tooltip;
			if (typeof icon.tooltip === 'function') {
				tooltip = icon.tooltip()
			}
			button.onmouseover = function() {
				menu_tooltip.textContent = tooltip;
			}
			button.onmouseout = function() {
				menu_tooltip.textContent = "";
			}
			if ('function' in icon) {
				button.onclick = icon.function;
			}
			menu.appendChild(button);
		}

		function t(label) {
			let tboxes = current_container.getElementsByClassName("tbox");
			if (tboxes.length > 0) {
				tboxes[0].innerHTML = TOOLTIP[label];
			} else {
				let tbox = document.createElement("div");
				tbox.className = "tbox";
				tbox.innerHTML = TOOLTIP[label];
				if (current_container==game) {
					dialogue.appendChild(tbox);
				} else {
					current_container.appendChild(tbox);
				}
				tbox.onclick = function(e){ this.remove() };
			}
			event.cancelBubble = true;
		}

		function cleart() {
			if (current_container.getElementsByClassName("tbox").length > 0) {
				current_container.removeChild(document.querySelector(".tbox"))
			}
		}

		var counter = 0;
		function animate() {
			requestAnimationFrame(animate);

			counter++;
		}
	</script>
	<script src="whispers.js"></script>

</html>