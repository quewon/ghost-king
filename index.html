<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>boo</title>
		<link rel="stylesheet" href="style.css">
	</head>

	<body>
		<div id="curtain"></div>
		<div id="chars" class="container">
			<h1>ghost club blues</h1>
			<div id="character_selection">
				<button onclick="selectKid('kitty')">kitty</button>
				<button onclick="selectKid('pup')"><p>pup<br />
					<i>coming soon!</i></p></button>
				<button onclick="selectKid('bird')"><p>bird<br />
					<i>coming soon!</i></p></button>
				<button id="play_button" class="button_secondary" onclick="play()">play as&nbsp;<span id="name"></span></button>
			</div>
			<div id="character_info"></div>
		</div>
		<div id="game" class="container">
			<div id="scene_name"></div>
			<div id="dialogue"></div>
			<div id="menu"></div><div id="menu_tooltip"></div>
		</div>
	</body>

	<script src="icons.js"></script>
	<script src="dialog.js"></script>
	<script src="objects.js"></script>
	<script>
		var kid;
		var inventory = {
			kitty: [OBJECT.kGLOWSTICK, OBJECT.kGLOWSTICK, OBJECT.kBOMB, OBJECT.kSPYPEN, OBJECT.kWATCH]
		};
		var kid_colors = {
			kitty: "#fff49d",
			pup: "#9dceff",
			bird: "#ff9db7"
		};
		var kid_colors_strong = {
			kitty: "#ffe24f",
			pup: "#4fcdff",
			bird: "#ff4f90"
		};

		var char_info = document.getElementById("character_info");
		var game = document.getElementById("game");
		var menu = document.getElementById("menu");
		var menu_tooltip = document.getElementById("menu_tooltip");
		var root = document.documentElement;

		window.oncontextmenu = function() {
			return false
		};

		function selectKid(name) {
			kid = name;
			char_info.style.display = "inline-block";
			char_info.className = "info_enter";
			char_info.innerHTML = kid_info[name];

			document.getElementById("play_button").style.display = "flex";
			document.getElementById("play_button").className = "button_secondary flicker-in";
			root.style.setProperty("--highlight", kid_colors[name]);

			cleart();

			document.getElementById("name").textContent = name;
		}

		function play() {
			transition(kid_colors[kid], game);
			let menu = kid_menu[kid];
			for (let i=0; i<menu.length; i++) {
				printMenuIcon(kid_menu[kid][i])
			}
			print(kid, 1, window.event);
			document.querySelector("title").textContent = kid;
			animate();
		}

		var current_container = document.getElementById("chars");
		function transition(color, container) {
			let curtain = document.getElementById("curtain");
			curtain.style.background = color;
			curtain.className = "curtain_wipe";
			setTimeout(function() {
				current_container.style.display = "none";
				document.body.style.background = color;
				curtain.className = "";
				container.style.display = "block";
				current_container = container;
			}, 2000);
		}

		var dialogue = document.getElementById("dialogue");
		function print(kid, step, e) {
			cleart();

			if (DIALOG[kid][0]+step > 0) {
				DIALOG[kid][0] += step;
			}
			let i = DIALOG[kid][0];
			let d = DIALOG[kid][i];
			d = d.replace("<<", "<span class='caret'> ...</span>");
			if (d.includes('[[t: ')) {
				d = d.replace("[[t: ", `<a onclick="t('`);
				d = d.replace("]]", `')">`)
				d = d.replace("[[/t]]", `</a>`);
			}
			dialogue.innerHTML = d;
		}

		function printMenuIcon(icon) {
			var button = document.createElement("button");
			button.textContent = icon.name;
			let tooltip = icon.tooltip;
			if (typeof icon.tooltip === 'function') {
				tooltip = icon.tooltip()
			}
			button.onmouseover = function() {
				menu_tooltip.textContent = tooltip;
			}
			button.onmouseout = function() {
				menu_tooltip.textContent = "";
			}
			if ('function' in icon) {
				button.onclick = icon.function;
			} else {
				button.className = "static"
			}
			menu.appendChild(button);
		}

		function t(label) {
			let tboxes = current_container.getElementsByClassName("tbox");
			if (tboxes.length > 0) {
				tboxes[0].innerHTML = TOOLTIP[label];
			} else {
				let tbox = document.createElement("div");
				tbox.className = "tbox";
				tbox.innerHTML = TOOLTIP[label];
				if (current_container==game) {
					dialogue.appendChild(tbox);
				} else {
					current_container.appendChild(tbox);
				}
				tbox.onclick = function(e){ this.remove() };
			}
			event.cancelBubble = true;
		}

		function cleart() {
			if (current_container.getElementsByClassName("tbox").length > 0) {
				current_container.removeChild(document.querySelector(".tbox"))
			}
		}

		var counter = 0;
		function animate() {
			requestAnimationFrame(animate);

			counter++;
		}
	</script>
	<script src="whispers.js"></script>

</html>